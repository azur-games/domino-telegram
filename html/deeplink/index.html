<html>
<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <meta name="color-scheme" content="light dark">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">

    <meta property="og:url" content="https://domino-king.com"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Domino-King"/>
    <meta property="og:description" content="Best domino game online!"/>
    <meta property="og:image" content="https://domino-king.com/images/deeplink_logo.png"/>
    <meta property="fb:app_id" content="1294253131708056"/>

    <link rel="stylesheet" href="../index.css" fetchpriority="high">
    <link href="https://domino-king.com/images/deeplink_logo.png" rel="icon" type="image/png">
    <link rel="alternate" href="android-app://azur.domino.king/https/domino-king.com/deeplink/"/>
    <title>Domino-King</title>
</head>
<body>
<script>
    const isAndroid = () => {
        try {
            const toMatch = [
                /Android/i,
                // /webOS/i,
            ];

            return toMatch.some((toMatchItem) => {
                return navigator.userAgent.match(toMatchItem);
            });
        } catch (e) {
            return false;
        }
    }

    const isIOS = () => {
        try {
            return (/iPad|iPhone|iPod/.test(navigator.platform) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&
                !window.MSStream;
        } catch (e) {
            return false;
        }
    }

    /**
     function isIOS() {
     return [
     'iPad Simulator',
     'iPhone Simulator',
     'iPod Simulator',
     'iPad',
     'iPhone',
     'iPod'
     ].includes(navigator.platform)
     // iPad on iOS 13 detection
     || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
     }
     */

    const curLoc = location.href.indexOf('?') < 0 ? location.href + "?empty=true" : location.href;

    const androidId = "azur.domino.king"
    const iosId = "id6737688575"
    const externalAndroidMarketUrl = 'https://market.android.com/details?id=' + androidId + '&referrer=' + encodeURIComponent('deeplink=' + encodeURIComponent(location.search.substring(1)));
    const externalIosLink = 'https://itunes.apple.com/app/' + iosId;

    if (isAndroid()) {
        document.writeln("Android. <br/>")

        // doesn't work with referrer in fallback but shows a bubble in chrome (continue in market)
        const internalAndroidMarketUrl1 = 'market://details?id=' + androidId + '&referrer=' + encodeURIComponent('deeplink=' + encodeURIComponent(location.search.substring(1)));
        ;

        // doesn't work with referrer in fallback and doesn't show a bubble in chrome (continue in market), it requires an additional click
        const internalAndroidMarketUrl2 = `intent://${externalAndroidMarketUrl.substring(8)}#Intent;package=com.android.vending;action=android.intent.action.VIEW;category=android.intent.category.DEFAULT;category=android.intent.category.BROWSABLE;scheme=https;S.browser_fallback_url=${curLoc + "&outmarket=true"};end`;


        // don't use market applink
        // const outmarket = curLoc.indexOf('outmarket') > 0;
        // const inmarket = curLoc.indexOf('inmarket') > 0;
        // const applink = `intent://${curLoc.substring(8)}#Intent;package=com.azur.belote;action=android.intent.action.VIEW;category=android.intent.category.DEFAULT;category=android.intent.category.BROWSABLE;scheme=https;S.browser_fallback_url=${curLoc + "&inmarket=true"};end`;
        // const autolink = outmarket ? externalAndroidMarketUrl : inmarket ? internalAndroidMarketUrl1 : applink;
        // const manuallink = outmarket ? externalAndroidMarketUrl : inmarket ? internalAndroidMarketUrl2 : applink;

        const manuallink = externalAndroidMarketUrl;
        const autolink = `intent://${curLoc.substring(8)}#Intent;package=${androidId};action=android.intent.action.VIEW;category=android.intent.category.DEFAULT;category=android.intent.category.BROWSABLE;scheme=https;S.browser_fallback_url=${externalAndroidMarketUrl};end`;

        document.write(`<p id='redirect'><a href='${manuallink}'>[Tap here]</a> if the automatic redirect does not work.</p>`);
        location.href = autolink;
    } else if (isIOS()) {
        localStorage.setItem("lastDeeplink", location.href);
        document.write(`<p id='redirect'><a href='${externalIosLink}'>[Tap here]</a> if the automatic redirect does not work.</p>`);
        location.href = externalIosLink;
    } else {
        const autolink = location.protocol + "//" + location.host + location.pathname.replace("deeplink/", "") + "#" + (location.search || "?").substring(1);
        document.write(`<p id='redirect'><a href='${autolink}'>[Click here]</a> if the automatic redirect does not work.</p>`);
        location.href = autolink;
    }


</script>

</body>
</html>
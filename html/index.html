<!DOCTYPE html>
<html>
<head>
    <!-- Yandex.Metrika counter -->
    <!--    <script type="text/javascript">-->
    <!--        (function (m, e, t, r, i, k, a) {-->
    <!--            m[i] = m[i] || function () {-->
    <!--                (m[i].a = m[i].a || []).push(arguments)-->
    <!--            };-->
    <!--            m[i].l = 1 * new Date();-->
    <!--            for (var j = 0; j < document.scripts.length; j++) {-->
    <!--                if (document.scripts[j].src === r) {-->
    <!--                    return;-->
    <!--                }-->
    <!--            }-->
    <!--            k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)-->
    <!--        })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js?id=104253554', 'ym');-->

    <!--        ym(104253554, 'init', {ssr: true, webvisor: true, clickmap: true, ecommerce: "dataLayer", accurateTrackBounce: true, trackLinks: true});-->
    <!--    </script>-->
    <meta content="no-cache, no-store, must-revalidate" http-equiv="Cache-Control"/>
    <meta content="no-cache" http-equiv="Pragma"/>
    <meta content="0" http-equiv="Expires"/>
    <link href="favicon.ico" rel="icon" type="image/x-icon">
    <meta charset="utf-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="1294253131708056" property="fb:app_id"/>
    <link href="fonts.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <link href="https://domino-king.com/images/deeplink_logo.png" rel="icon" type="image/png">
    <link rel="preload" href="./assets/fonts/Commissioner-400.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="./assets/fonts/Commissioner-500.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="./assets/fonts/Commissioner-600.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="./assets/fonts/Commissioner-700.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="./assets/fonts/Commissioner-800.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="./assets/fonts/Commissioner-900-Italic.woff2" as="font" type="font/woff2" crossorigin>
    <!-- HTML Meta Tags -->
    <title>Domino-King. Best domino game online!</title>
    <meta content="Now you can play domino online without downloading mobile app!" name="description">

    <!-- Facebook Meta Tags -->
    <meta content="https://domino-king.com" property="og:url">
    <meta content="website" property="og:type">
    <meta content="Domino-King. Best online Domino game!" property="og:title">
    <meta content="Now you can play domino online without downloading mobile app!" property="og:description">
    <meta content="https://domino-king.com/images/deeplink_logo.png" property="og:image">
</head>
<body style="overflow: hidden;">
<!--<div style="color: white; height: 300px; overflow-y: scroll; " id="debug">123123</div>-->
<div class="overflow_wrapper" id="wrapper">
    <div class="logo_container" id="logo_container">
        <div class="char"></div>
        <div class="logo" id="logo"></div>
    </div>
    <div id="app"></div>
    <div class="preloader" id="preloader">
        <div class="preloader_inner">
            <div>
                <center>
                    <div class="preloader_text" id="loading_text"
                         style=" font-size:5vh;margin-top:-100px;margin-bottom:20px;"></div>
                </center>
                <div class="progress_bar" id="progress_bar">
                    <div class="bar" id="bar"></div>
                </div>
                <center>
                    <div class="preloader_text bar_percents" id="bar_percents">0%</div>
                </center>
            </div>
            <div id="no_webgl" class="no_webgl">
                <img src="images/alert.png" style="margin: 3vh; width:20vh;height:20vh;"/>
                <div style="font-size: 5vh; white-space: nowrap;">You must turn on WebGL to play</div>
                <div style="font-size: 4vh; white-space: nowrap;">Чтобы играть, включите поддержку WebGL</div>
            </div>
        </div>
    </div>
</div>
<script>
    if (window.location.href.includes("http://")) {
        //window.location.href = window.location.href.split("http://").join("https://");
    }

    document.addEventListener("gesturestart", function (e) {
        e.preventDefault();
        document.body.style.zoom = 1;
    });

    document.addEventListener("gesturechange", function (e) {
        e.preventDefault();
        document.body.style.zoom = 1;
    });
    document.addEventListener("gestureend", function (e) {
        e.preventDefault();
        document.body.style.zoom = 1;
    });

    window.addEventListener("DOMContentLoaded", async event => {
        if ('BeforeInstallPromptEvent' in window) {
            console.log("⏳ BeforeInstallPromptEvent supported but not fired yet");
        } else {
            console.log("❌ BeforeInstallPromptEvent NOT supported");
        }
    });

    window.htmlPlatform = "WEB";

    window.noWebGL = function () {
        document.getElementById("no_webgl").style.display = "flex";
        document.getElementById("logo").style.display = "none";
        document.getElementById("progress_bar").style.display = "none";
    }

    loadVersion();

    function loadVersion() {
        let versionRequest = new XMLHttpRequest();
        versionRequest.addEventListener("load", function (event) {
            window.gameBundleVersion = event.target.response;
            loadBundle();
        }, false);

        versionRequest.open("GET", "./cfg/version.txt?" + Math.floor(Math.random() * 1000));
        versionRequest.send();
    }

    async function loadBundle() {
        const progressDiv = document.getElementById("bar");
        const persentsText = document.getElementById("bar_percents");

        // Get list of JS files from manifest or use fallback names
        const bundles = ['vendors', 'pixi', 'main'];
        const totalBundles = bundles.length;
        let loadedBundles = 0;

        function updateProgress(bundleProgress = 0) {
            const overallProgress = (loadedBundles + bundleProgress) / totalBundles;
            const percents = Math.max(7, Math.ceil(overallProgress * 20));
            const percentsMin20 = Math.min(percents, 20);
            progressDiv.style.width = percentsMin20 + "%";
            persentsText.innerText = percentsMin20 + "%";
        }

        // Load bundles sequentially to maintain dependency order
        for (const bundleName of bundles) {
            const fileName = `js/${bundleName}.js`;
            await loadScript(fileName, updateProgress);
            loadedBundles++;
            updateProgress(0);
        }
    }

    function loadScript(fileName, progressCallback) {
        return new Promise((resolve, reject) => {
            const scriptRequest = new XMLHttpRequest();

            scriptRequest.addEventListener("progress", function (event) {
                if (event.lengthComputable) {
                    const bundleProgress = event.loaded / event.total;
                    progressCallback(bundleProgress);
                }
            }, false);

            scriptRequest.addEventListener("load", function (event) {
                const scriptElement = document.createElement("script");
                scriptElement.textContent = event.target.response;
                scriptElement.type = "text/javascript";
                document.body.appendChild(scriptElement);
                resolve();
            }, false);

            scriptRequest.addEventListener("error", function (event) {
                reject(new Error(`Failed to load ${fileName}`));
            }, false);

            scriptRequest.open("GET", fileName + "?" + window.gameBundleVersion);
            scriptRequest.send();
        });
    }

    window.loadingTextDiv = document.getElementById("loading_text");
    window.language = !!window["FBInstant"] ? FBInstant.getLocale() : window.navigator.language;
    var localStorageLanguage = JSON.parse(window.localStorage.getItem("CURRENT_LANGUAGE"));
    if (localStorageLanguage != null) {
        window.language = localStorageLanguage;
    }

    let ladingTextLocales = {
        en: "Loading...",
        ru: "Загрузка...",
        fr: "Chargement...",
        es: "Cargando...",
        th: "กำลังโหลด...",
        vi: "Đang tải...",
        id: "Memuat...",
        ms: "Memuatkan..."
    }

    switch (true) {
        case window.language.includes("ru"):
            loadingTextDiv.innerText = ladingTextLocales.ru;
            break;
        case window.language.includes("fr"):
            loadingTextDiv.innerText = ladingTextLocales.fr;
            break;
        case window.language.includes("es"):
            loadingTextDiv.innerText = ladingTextLocales.es;
            break;
        case window.language.includes("th"):
            loadingTextDiv.innerText = ladingTextLocales.th;
            break;
        case window.language.includes("vi"):
            loadingTextDiv.innerText = ladingTextLocales.vi;
            break;
        case window.language.includes("id"):
            loadingTextDiv.innerText = ladingTextLocales.id;
            break;
        case window.language.includes("ms"):
            loadingTextDiv.innerText = ladingTextLocales.ms;
            break;
        default:
            loadingTextDiv.innerText = ladingTextLocales.en;
    }
</script>
</body>
</html>